<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC WebAssembly - FPGA Synthesis & Verification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status.ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        textarea, select, input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .output-section {
            grid-column: 1 / -1;
        }

        .output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .examples {
            margin-top: 15px;
        }

        .example-btn {
            display: inline-block;
            margin: 5px;
            padding: 8px 16px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .example-btn:hover {
            background: #e0e0e0;
        }

        .commands-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .command-item {
            padding: 8px 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .command-item:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîß ABC WebAssembly</h1>
            <p class="subtitle">Full-Featured FPGA Synthesis & Formal Verification</p>
            <p class="subtitle">AIGER ‚Ä¢ BLIF ‚Ä¢ Verilog Support</p>
        </header>

        <div class="main-content">
            <!-- Status Panel -->
            <div class="panel" style="grid-column: 1 / -1;">
                <h2>System Status</h2>
                <div id="status" class="status loading">
                    ‚è≥ Loading ABC WebAssembly module...
                </div>
            </div>

            <!-- Input Panel -->
            <div class="panel">
                <h2>Input</h2>
                
                <div class="form-group">
                    <label for="inputFormat">Input Format:</label>
                    <select id="inputFormat">
                        <option value="blif">BLIF</option>
                        <option value="aiger">AIGER</option>
                        <option value="verilog">Verilog</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="inputFile">Upload File (optional):</label>
                    <input type="file" id="inputFile" accept=".blif,.aig,.aiger,.v">
                </div>

                <div class="form-group">
                    <label for="inputCode">Or Paste Code:</label>
                    <textarea id="inputCode" placeholder="Paste your BLIF, AIGER, or Verilog code here..."></textarea>
                </div>

                <div class="examples">
                    <strong>Examples:</strong>
                    <span class="example-btn" onclick="loadExample('blif')">Simple BLIF</span>
                    <span class="example-btn" onclick="loadExample('adder')">Full Adder</span>
                    <span class="example-btn" onclick="loadExample('mux')">Multiplexer</span>
                </div>
            </div>

            <!-- Synthesis Panel -->
            <div class="panel">
                <h2>Synthesis Options</h2>
                
                <div class="form-group">
                    <label for="outputFormat">Output Format:</label>
                    <select id="outputFormat">
                        <option value="aig">AIGER</option>
                        <option value="blif">BLIF</option>
                        <option value="verilog">Verilog</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="synthCommands">Synthesis Commands (one per line):</label>
                    <textarea id="synthCommands" rows="8">strash
balance
rewrite
rewrite -z
balance
rewrite
balance</textarea>
                </div>

                <div class="button-group">
                    <button onclick="runSynthesis()" id="synthBtn">üöÄ Synthesize</button>
                    <button onclick="resetABC()" id="resetBtn">üîÑ Reset</button>
                </div>

                <strong>Quick Commands:</strong>
                <div class="commands-list">
                    <div class="command-item" onclick="runCommand('print_stats')">Stats</div>
                    <div class="command-item" onclick="runCommand('strash')">Strash</div>
                    <div class="command-item" onclick="runCommand('balance')">Balance</div>
                    <div class="command-item" onclick="runCommand('rewrite')">Rewrite</div>
                    <div class="command-item" onclick="runCommand('refactor')">Refactor</div>
                    <div class="command-item" onclick="runCommand('map')">Map</div>
                </div>
            </div>

            <!-- Output Panel -->
            <div class="panel output-section">
                <h2>Output</h2>
                <div class="button-group">
                    <button onclick="downloadOutput()">üíæ Download Output</button>
                    <button onclick="clearOutput()">üóëÔ∏è Clear</button>
                </div>
                <div id="output" class="output">ABC output will appear here...</div>
            </div>
        </div>
    </div>

    <script src="abc.js"></script>
    <script src="abc-wrapper.js"></script>
    <script>
        let abc = null;
        let currentOutput = '';

        // Initialize ABC on page load
        async function init() {
            try {
                abc = new ABCWrapper();
                await abc.initialize();
                
                document.getElementById('status').className = 'status ready';
                document.getElementById('status').textContent = '‚úÖ ABC Ready - All features enabled (AIGER, BLIF, Verilog, synthesis, verification)';
                
                appendOutput('=== ABC WebAssembly Ready ===\n');
                appendOutput('System initialized successfully.\n');
                appendOutput('You can now upload files or paste code to synthesize.\n\n');
            } catch (e) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = '‚ùå Error: ' + e.message;
                appendOutput('ERROR: ' + e.message + '\n');
            }
        }

        // Append text to output
        function appendOutput(text) {
            currentOutput += text;
            document.getElementById('output').textContent = currentOutput;
            document.getElementById('output').scrollTop = document.getElementById('output').scrollHeight;
        }

        // Clear output
        function clearOutput() {
            currentOutput = '';
            document.getElementById('output').textContent = 'Output cleared.';
        }

        // Load example
        function loadExample(type) {
            const examples = {
                'blif': `.model simple
.inputs a b c
.outputs f
.names a b c f
111 1
.end`,
                'adder': `.model adder
.inputs a b cin
.outputs sum cout
.names a b cin sum
001 1
010 1
100 1
111 1
.names a b cin cout
011 1
101 1
110 1
111 1
.end`,
                'mux': `.model mux2to1
.inputs a b sel
.outputs out
.names a sel out
10 1
.names b sel n1
01 1
.names out n1 final
1- 1
-1 1
.outputs final
.end`
            };
            
            document.getElementById('inputCode').value = examples[type];
            document.getElementById('inputFormat').value = 'blif';
        }

        // Handle file upload
        document.getElementById('inputFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('inputCode').value = event.target.result;
                    appendOutput(`Loaded file: ${file.name}\n`);
                };
                reader.readAsText(file);
            }
        });

        // Run synthesis
        async function runSynthesis() {
            if (!abc) {
                alert('ABC not initialized yet!');
                return;
            }

            const inputCode = document.getElementById('inputCode').value;
            if (!inputCode.trim()) {
                alert('Please provide input code!');
                return;
            }

            const inputFormat = document.getElementById('inputFormat').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const commands = document.getElementById('synthCommands').value.split('\n').filter(c => c.trim());

            appendOutput('\n=== Starting Synthesis ===\n');
            appendOutput(`Input: ${inputFormat.toUpperCase()}\n`);
            appendOutput(`Output: ${outputFormat.toUpperCase()}\n`);
            appendOutput(`Commands: ${commands.length}\n\n`);

            try {
                // Disable button
                document.getElementById('synthBtn').disabled = true;

                // Write input file
                const inputExt = inputFormat === 'verilog' ? 'v' : (inputFormat === 'aiger' ? 'aig' : inputFormat);
                const inputFile = `input.${inputExt}`;
                abc.writeFile(inputFile, inputCode);
                appendOutput(`‚úì Written input file: ${inputFile}\n`);

                // Read file
                const readResult = abc.executeCommand(`read ${inputFile}`);
                appendOutput(`‚úì Read file\n${readResult.output}\n`);

                // Execute synthesis commands
                for (const cmd of commands) {
                    if (cmd.trim()) {
                        appendOutput(`\nExecuting: ${cmd}\n`);
                        const result = abc.executeCommand(cmd);
                        if (result.output) {
                            appendOutput(result.output + '\n');
                        }
                    }
                }

                // Write output
                const outputExt = outputFormat === 'verilog' ? 'v' : (outputFormat === 'aiger' ? 'aig' : outputFormat);
                const outputFile = `output.${outputExt}`;
                const writeResult = abc.executeCommand(`write ${outputFile}`);
                appendOutput(`\n‚úì Written output file: ${outputFile}\n${writeResult.output}\n`);

                // Read and display output
                if (abc.fileExists(outputFile)) {
                    const outputContent = abc.readFile(outputFile, 'utf8');
                    appendOutput('\n=== Output Content ===\n');
                    appendOutput(outputContent);
                    appendOutput('\n\n=== Synthesis Complete ===\n');
                }

            } catch (e) {
                appendOutput('\n‚ùå Error: ' + e.message + '\n');
            } finally {
                document.getElementById('synthBtn').disabled = false;
            }
        }

        // Run single command
        function runCommand(cmd) {
            if (!abc) {
                alert('ABC not initialized yet!');
                return;
            }

            appendOutput(`\n> ${cmd}\n`);
            const result = abc.executeCommand(cmd);
            appendOutput(result.output + '\n');
            if (result.error) {
                appendOutput('Error: ' + result.error + '\n');
            }
        }

        // Reset ABC
        function resetABC() {
            if (abc) {
                abc.reset();
                appendOutput('\n=== ABC Reset ===\n');
            }
        }

        // Download output
        function downloadOutput() {
            const blob = new Blob([currentOutput], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'abc_output.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
